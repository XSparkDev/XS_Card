{
  "info": {
    "name": "XSCard Events QR Code Check-in System API - Fixed",
    "description": "Fixed version of the comprehensive test collection for the QR code check-in system backend implementation",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.2"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{authToken}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8383/api",
      "type": "string"
    },
    {
      "key": "authToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "attendeeToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "eventId",
      "value": "",
      "type": "string"
    },
    {
      "key": "ticketId",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "organizerId",
      "value": "",
      "type": "string"
    },
    {
      "key": "verificationToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "qrDataString",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Authentication & Setup",
      "item": [
        {
          "name": "Login as Organizer",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.success && response.token) {",
                  "        pm.collectionVariables.set('authToken', response.token);",
                  "        pm.collectionVariables.set('organizerId', response.user.uid);",
                  "        console.log('‚úÖ Organizer auth successful');",
                  "        console.log('Auth token set:', response.token.substring(0, 20) + '...');",
                  "        console.log('Organizer ID set:', response.user.uid);",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå Organizer login failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"testehakke@gufum.com\",\n  \"password\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Login as Attendee",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.success && response.token) {",
                  "        pm.collectionVariables.set('attendeeToken', response.token);",
                  "        pm.collectionVariables.set('userId', response.user.uid);",
                  "        console.log('‚úÖ Attendee auth successful');",
                  "        console.log('Attendee token set:', response.token.substring(0, 20) + '...');",
                  "        console.log('User ID set:', response.user.uid);",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå Attendee login failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"pule@xspark.co.za\",\n  \"password\": \"P.zzle$0\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "2. Event Management",
      "item": [
        {
          "name": "Create Test Event",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.success && response.event) {",
                  "        pm.collectionVariables.set('eventId', response.event.id);",
                  "        console.log('‚úÖ Event created successfully');",
                  "        console.log('Event ID set:', response.event.id);",
                  "        console.log('Event title:', response.event.title);",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå Event creation failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"QR Code Test Event\",\n  \"description\": \"Test event for QR code check-in system\",\n  \"eventDate\": \"2025-07-15T10:00:00.000Z\",\n  \"endDate\": \"2025-07-15T18:00:00.000Z\",\n  \"location\": {\n    \"venue\": \"Test Venue\",\n    \"address\": \"123 Test Street\",\n    \"city\": \"Test City\",\n    \"country\": \"Test Country\"\n  },\n  \"category\": \"technology\",\n  \"eventType\": \"free\",\n  \"ticketPrice\": 0,\n  \"maxAttendees\": 100,\n  \"visibility\": \"public\",\n  \"tags\": [\"qr-code\", \"testing\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events"
              ]
            }
          }
        },
        {
          "name": "Publish Event",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Event published successfully');",
                  "} else {",
                  "    console.log('‚ùå Event publish failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/events/{{eventId}}/publish",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "{{eventId}}",
                "publish"
              ]
            }
          }
        },
        {
          "name": "Register for Event (as Attendee)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('attendeeToken')",
                  "});",
                  "console.log('üé´ Registering attendee for event...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.success && response.ticket) {",
                  "        pm.collectionVariables.set('ticketId', response.ticket.id);",
                  "        console.log('‚úÖ Registration successful');",
                  "        console.log('Ticket ID set:', response.ticket.id);",
                  "        console.log('Ticket status:', response.ticket.status);",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå Registration failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"specialRequests\": \"No special requests for QR testing\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events/{{eventId}}/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "{{eventId}}",
                "register"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "3. QR Code Generation",
      "item": [
        {
          "name": "Generate QR Code for Ticket",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('attendeeToken')",
                  "});",
                  "console.log('üì± Generating QR code for ticket...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.success) {",
                  "        pm.collectionVariables.set('verificationToken', response.verificationToken);",
                  "        console.log('‚úÖ QR code generated successfully');",
                  "        console.log('Verification token:', response.verificationToken.substring(0, 20) + '...');",
                  "        ",
                  "        // Create QR data JSON string for testing",
                  "        const qrData = {",
                  "            eventId: pm.collectionVariables.get('eventId'),",
                  "            userId: pm.collectionVariables.get('userId'),",
                  "            ticketId: pm.collectionVariables.get('ticketId'),",
                  "            verificationToken: response.verificationToken,",
                  "            timestamp: Date.now(),",
                  "            type: 'event_checkin',",
                  "            version: '1.0'",
                  "        };",
                  "        ",
                  "        pm.collectionVariables.set('qrDataString', JSON.stringify(qrData));",
                  "        console.log('üìã QR data prepared for testing');",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå QR generation failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/tickets/{{ticketId}}/qr",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "tickets",
                "{{ticketId}}",
                "qr"
              ]
            }
          }
        },
        {
          "name": "Generate Bulk QR Codes for Event",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "console.log('üìä Generating bulk QR codes...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('‚úÖ Bulk QR generation completed');",
                  "    console.log('Generated:', response.generatedCount, 'QR codes');",
                  "    console.log('Errors:', response.errorCount);",
                  "} else {",
                  "    console.log('‚ùå Bulk QR generation failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/events/{{eventId}}/qr/bulk",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "{{eventId}}",
                "qr",
                "bulk"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "4. QR Code Validation & Check-in",
      "item": [
        {
          "name": "Validate QR Code",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "",
                  "const qrDataString = pm.collectionVariables.get('qrDataString');",
                  "pm.request.body.raw = JSON.stringify({",
                  "    qrData: qrDataString",
                  "});",
                  "console.log('üîç Validating QR code...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.success && response.valid) {",
                  "        console.log('‚úÖ QR code is valid');",
                  "        console.log('User:', response.userData?.name);",
                  "        console.log('Event:', response.eventData?.title);",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå QR validation failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrData\": \"placeholder\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events/qr/validate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "qr",
                "validate"
              ]
            }
          }
        },
        {
          "name": "Process Check-in",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "",
                  "const qrDataString = pm.collectionVariables.get('qrDataString');",
                  "pm.request.body.raw = JSON.stringify({",
                  "    qrData: qrDataString",
                  "});",
                  "console.log('‚úÖ Processing check-in...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.success) {",
                  "        console.log('üéâ Check-in successful!');",
                  "        console.log('User:', response.userData?.name);",
                  "        console.log('Check-in time:', response.checkedInAt);",
                  "    }",
                  "} else {",
                  "    console.log('‚ùå Check-in failed:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrData\": \"placeholder\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events/qr/checkin",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "qr",
                "checkin"
              ]
            }
          }
        },
        {
          "name": "Attempt Double Check-in (Should Fail)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "",
                  "const qrDataString = pm.collectionVariables.get('qrDataString');",
                  "pm.request.body.raw = JSON.stringify({",
                  "    qrData: qrDataString",
                  "});",
                  "console.log('üö´ Attempting double check-in (should fail)...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should fail with already used error', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 409]);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.false;",
                  "    pm.expect(response.error).to.be.oneOf(['ALREADY_USED', 'ALREADY_CHECKED_IN']);",
                  "    console.log('‚úÖ Double check-in correctly prevented');",
                  "    console.log('Error:', response.error);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrData\": \"placeholder\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events/qr/checkin",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "qr",
                "checkin"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "5. Event Management & Statistics",
      "item": [
        {
          "name": "Get Event Attendees",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "console.log('üë• Getting event attendees...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('‚úÖ Attendees retrieved');",
                  "    console.log('Total attendees:', response.totalAttendees);",
                  "    console.log('Checked in:', response.checkedInCount);",
                  "} else {",
                  "    console.log('‚ùå Failed to get attendees:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/events/{{eventId}}/attendees",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "{{eventId}}",
                "attendees"
              ]
            }
          }
        },
        {
          "name": "Get Check-in Statistics",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "console.log('üìä Getting check-in statistics...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('‚úÖ Statistics retrieved');",
                  "    console.log('Check-in rate:', response.checkInRate.toFixed(1) + '%');",
                  "    console.log('Total tickets:', response.totalTickets);",
                  "    console.log('Checked in:', response.checkedInCount);",
                  "} else {",
                  "    console.log('‚ùå Failed to get statistics:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/events/{{eventId}}/checkin/stats",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "{{eventId}}",
                "checkin",
                "stats"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "6. Error Testing",
      "item": [
        {
          "name": "Validate Invalid QR Code",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "console.log('üö´ Testing invalid QR code...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should fail with invalid format error', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.false;",
                  "    pm.expect(response.error).to.equal('INVALID_QR_FORMAT');",
                  "    console.log('‚úÖ Invalid QR correctly rejected');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrData\": \"invalid-qr-code-data\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events/qr/validate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "qr",
                "validate"
              ]
            }
          }
        },
        {
          "name": "Unauthorized Check-in Attempt",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('attendeeToken')",
                  "});",
                  "",
                  "const qrDataString = pm.collectionVariables.get('qrDataString');",
                  "pm.request.body.raw = JSON.stringify({",
                  "    qrData: qrDataString",
                  "});",
                  "console.log('üö´ Testing unauthorized check-in...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should fail with unauthorized error', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.false;",
                  "    pm.expect(response.error).to.equal('UNAUTHORIZED_ORGANIZER');",
                  "    console.log('‚úÖ Unauthorized access correctly prevented');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrData\": \"placeholder\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/events/qr/validate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "qr",
                "validate"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "7. Cleanup",
      "item": [
        {
          "name": "Delete Test Event",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.request.removeHeader('Authorization');",
                  "pm.request.headers.add({",
                  "    key: 'Authorization',",
                  "    value: 'Bearer ' + pm.collectionVariables.get('authToken')",
                  "});",
                  "console.log('üóëÔ∏è Cleaning up test event...');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Test event deleted successfully');",
                  "    console.log('üßπ Cleanup completed');",
                  "} else {",
                  "    console.log('‚ùå Failed to delete event:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/events/{{eventId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "events",
                "{{eventId}}"
              ]
            }
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "console.log('üöÄ Running:', pm.info.requestName);",
          "",
          "// Only set default auth token if no Authorization header exists",
          "if (!pm.request.headers.has('Authorization') && pm.collectionVariables.get('authToken')) {",
          "    pm.request.headers.add({",
          "        key: 'Authorization',",
          "        value: 'Bearer ' + pm.collectionVariables.get('authToken')",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "console.log('‚è±Ô∏è Response time:', pm.response.responseTime + 'ms');",
          "",
          "pm.test('Response time is acceptable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(10000);",
          "});",
          "",
          "// Only check JSON structure for successful responses",
          "if (pm.response.code < 500) {",
          "    pm.test('Response has proper JSON structure', function () {",
          "        try {",
          "            const response = pm.response.json();",
          "            pm.expect(response).to.have.property('success');",
          "        } catch (e) {",
          "            // Skip for non-JSON responses",
          "        }",
          "    });",
          "}"
        ]
      }
    }
  ]
}
